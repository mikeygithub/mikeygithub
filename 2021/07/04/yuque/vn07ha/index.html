

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <meta name="referrer" content="no-referrer"/>
  <link rel="apple-touch-icon" sizes="76x76" href="https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/favicon.png">
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/mikeygithub/jsDeliver@master/resource/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Mikey">
  <meta name="keywords" content="">
  
  <title>读书笔记篇-MySQL是怎样运行的 - 麦奇</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="/css/custom.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"mikeygithub.github.io","root":"/","version":"1.8.10","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":200}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"74301a15e5497361e93588eeee69f4b2","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="麦奇" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>麦奇</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/photo/">
                <i class="iconfont icon-image"></i>
                照片
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/todo/">
                <i class="iconfont icon-plan"></i>
                代办
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/music/">
                <i class="iconfont icon-music"></i>
                音乐
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/atom.xml">
                <i class="iconfont icon-rss"></i>
                RSS
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-briefcase"></i>
                其他
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" target="_blank" rel="noopener" href="https://www.yuque.com/aichihongdouheyumi/blog">
                    
                    在线创作
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/about/">
                    
                    关于麦奇
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://bing.ioliu.cn/v1/rand') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="读书笔记篇-MySQL是怎样运行的">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      Mikey
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-07-04 17:24" pubdate>
        2021年7月4日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      12.2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      132
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">读书笔记篇-MySQL是怎样运行的</h1>
            
            <div class="markdown-body">
              <p><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625325929222-a09d09f1-cc16-46e6-abec-79ef82602f86.png#clientId=u4a64baa2-9848-4&from=paste&height=280&id=ucfb1b30d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=560&originWidth=831&originalType=binary%E2%88%B6=1&size=303714&status=done&style=none&taskId=u1dfcd685-a4a1-489c-9290-5018012df48&width=415.5" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h1 id="第-1-章-装作自己是个小白-重新认识-MySQL"><a href="#第-1-章-装作自己是个小白-重新认识-MySQL" class="headerlink" title="第 1 章 装作自己是个小白-重新认识 MySQL"></a>第 1 章 装作自己是个小白-重新认识 MySQL</h1><h2 id="MySQL-的客户端／服务器架构"><a href="#MySQL-的客户端／服务器架构" class="headerlink" title="MySQL 的客户端／服务器架构"></a>MySQL 的客户端／服务器架构</h2><blockquote>
<p>MySQL 采用 C/S 结构</p>
</blockquote>
<h2 id="MySQL-的安装"><a href="#MySQL-的安装" class="headerlink" title="MySQL 的安装"></a>MySQL 的安装</h2><blockquote>
<p>小贴士： <code>MySQL</code>的大部分安装包都包含了服务器程序和客户端程序，不过在 Linux 下使用 RPM 包时会有单独的服 务器 RPM 包和客户端 RPM 包，需要分别安装。</p>
</blockquote>
<blockquote>
<p>类 UNIX 操作系统非常多，比如 FreeBSD、Linux、macOS、Solaris 等都属于 UNIX 操作系统的范畴</p>
</blockquote>
<p>​</p>
<p>目录信息</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">./bin<br>│── ibd2sdi<br>│── innochecksum<br>│── lz4_decompress<br>│── myisamchk<br>│── myisam_ftdump<br>│── myisamlog<br>│── myisampack<br>│── my_print_defaults<br>│── mysql<br>│── mysqladmin----<br>│── mysqlbinlog<br>│── mysqlcheck<br>│── mysql_config<br>│── mysql_config_editor<br>│── mysqld----个可执行文件就代表着MySQL服务器程序，运行这个可执行文件就可以直接启动一个服务器进程。<br>│── mysqld-debug----<br>│── mysqld_multi----可执行文件可以对每一个服务器进程的启动或停止进行监控。<br>│── mysqldump---导出数据相关功能<br>│── mysqldumpslow<br>│── mysqlimport---<br>│── mysql_migrate_keyring<br>│── mysqlpump<br>│── mysql_secure_installation<br>│── mysqlshow<br>│── mysqlslap<br>│── mysql_ssl_rsa_setup<br>│── mysql_tzinfo_to_sql<br>│── mysql_upgrade<br>│── perror<br>│── mysql.server----也是一个启动脚本，它会间接的调用 mysqld_safe ，在调用 mysql.server 时在后边指定 start参数就可以启动服务器程序了<br>│── mysqld_safe----是一个启动脚本，它会间接的调用 mysqld ，而且还顺便启动了另外一个监控进程，这个监控进程<br>│	在服务器进程挂了的时候，可以帮助重启它。另外，使用 mysqld_safe 启动服务器程序时，它会将服务器程序的<br>│	出错信息和其他诊断信息重定向到某个文件中，产生出错日志，这样可以方便我们找出发生错误的原因。<br>└── zlib_decompress<br></code></pre></div></td></tr></table></figure>

<p>1.启动 MySQL 服务器</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">service mysql start<br></code></pre></div></td></tr></table></figure>

<p>2.启动 MySQL 客户端</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">mysql -h主机名 -u用户名 -p密码<br></code></pre></div></td></tr></table></figure>

<p>​</p>
<p>MySQL 采用 TCP 作为服务器和客户端之间的网络通信协议。在网络环境下，每台计算机都有一个唯一的 IP 地 址 ，如果某个进程有需要采用 TCP 协议进行网络通信方面的需求，可以向操作系统申请一个 端口号 ，这是一个 整数值，它的取值范围是 0~65535 。这样在网络中的其他进程就可以通过 IP 地址 + 端口号 的方式来与这个进程 连接，这样进程之间就可以通过网络进行通信了。 MySQL 服务器启动的时候会默认申请 3306 端口号，之后就在这个端口号上等待客户端进程进行连接，用书面一 点的话来说， MySQL 服务器会默认监听 3306 端口。<br>​</p>
<p>端口冲突怎么办？</p>
<blockquote>
<p>如果端口冲突或者想使用其他端口运行可采用 mysqld -P3307。这样就指定来运行的端口。当然你登入的时候就应该采用 mysql -h127.0.0.1 -uroot -P3307 -p 来进行登入了。</p>
</blockquote>
<p>​</p>
<p>​</p>
<p>客户端进程可以采用 TCP/IP 、 命名管道或共享内存 、 Unix 域套接字 这几种方式之一来与服务 器进程建立连接，每当有一个客户端进程连接到服务器进程时，服务器进程都会创建一个线程来专门处理与这个 客户端的交互，当该客户端退出时会与服务器断开连接，服务器并不会立即把与该客户端交互的线程销毁掉，而是把它缓存起来，在另一个新的客户端再进行连接时，把这个缓存的线程分配给该新客户端。这样就起到了不频繁创建和销毁线程的效果，从而节省开销。从这一点大家也能看出， MySQL 服务器会为每一个连接进来的客户端 分配一个线程，但是线程分配的太多了会严重影响系统性能，所以我们也需要限制一下可以同时连接到服务器的 客户端数量<br>​</p>
<h2 id="查询缓存"><a href="#查询缓存" class="headerlink" title="查询缓存"></a>查询缓存</h2><p>如果两个查询请求在任何字符上的不同（例如：空格、注释、大小写），都会导致缓存不会命中。另外，如果查询请求中包含某些系统函数、用户自定义变量和函数、一些系统表，如 mysql 、information_schema、 performance_schema 数据库中的表，那这个请求就不会被缓存。以某些系统函数举例，可能同样的函数的两次调用会产生不一样的结果，比如函数 NOW ，每次调用都会产生最新的当前时间，如果在一个查询请求中调用了这个函数，那即使查询请求的文本信息都一样，那不同时间的两次查询也应该得到不同的结果，如果在第一次查询时就缓存了，那第二次查询的时候直接使用第一次查询的结果就是错误的！<br>​</p>
<p>不过既然是缓存，那就有它缓存失效的时候。MySQL 的缓存系统会监测涉及到的每张表，只要该表的结构或者数据被修改，如对该表使用了 INSERT 、 UPDATE 、 DELETE 、 TRUNCATE TABLE 、 ALTER TABLE 、 DROP TABLE 或 DROP DATABASE 语句，那使用该表的所有高速缓存查询都将变为无效并从高速缓存中删除！<br>​</p>
<p>小贴士：</p>
<blockquote>
<p>虽然查询缓存有时可以提升系统性能，但也不得不因维护这块缓存而造成一些开销，比如每次都要去查询缓存中检索，查询请求处理完需要更新查询缓存，维护该查询缓存对应的内存区域。从 MySQL 5.7.20 开始，不推荐使用查询缓存，并在 MySQL 8.0 中删除。</p>
</blockquote>
<p>​</p>
<h2 id="语法解析"><a href="#语法解析" class="headerlink" title="语法解析"></a>语法解析</h2><p>如果查询缓存没有命中，接下来就需要进入正式的查询阶段了。因为客户端程序发送过来的请求只是一段文本而已，所以 MySQL 服务器程序首先要对这段文本做分析，判断请求的语法是否正确，然后从文本中将要查询的表、各种查询条件都提取出来放到 MySQL 服务器内部使用的一些数据结构上来。<br>​</p>
<blockquote>
<p>这个从指定的文本中提取出我们需要的信息本质上算是一个编译过程，涉及词法解析、语法分析、语义分析等阶段</p>
</blockquote>
<h2 id="查询优化"><a href="#查询优化" class="headerlink" title="查询优化"></a>查询优化</h2><p>MySQL 的优化程序会对我们的语句做一些优化，如外连接转换为内连接、表达式简化、子查询转为连接吧啦吧啦的一堆东西。优化的结果就是生成一个执行计划，这个执行计划表明了应该使用哪些索引进行查询，表之间的连接顺序是啥样的。我们可以使用 EXPLAIN 语句来查看某个语句的执行计划。<br>​</p>
<h2 id="储存引擎"><a href="#储存引擎" class="headerlink" title="储存引擎"></a>储存引擎</h2><p>​ 小贴士：</p>
<blockquote>
<p>为什么叫引擎呢？因为这个名字更拉风～ 其实这个存储引擎以前叫做<code>表处理器</code>，后来可能人们觉得太土，就改成了<code>存储引擎</code>的叫法，它的功能就是接收上层传下来的指令，然后对表中的数据进行提取或写入操作。</p>
</blockquote>
<p>为了管理方便，人们把 连接管理 、 查询缓存 、 语法解析 、 查询优化 这些并不涉及真实数据存储的功能划分为 MySQL server 的功能，把真实存取数据的功能划分为 存储引擎 的功能。各种不同的存储引擎向上边的 MySQL server 层提供统一的调用接口（也就是存储引擎 API），包含了几十个底层函数，像”读取索引第一条内容”、”读取索引下一条内容”、”插入记录”等等。<br>所以在 MySQL server 完成了查询优化后，只需按照生成的执行计划调用底层存储引擎提供的 API，获取到数据后返回给客户端就好了。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625848725553-dd0a296d-c2d1-4db8-bc8d-5c1d70735740.png#clientId=u3d9adbb4-f372-4&from=paste&height=398&id=uf181a3ee&margin=%5Bobject%20Object%5D&name=image.png&originHeight=398&originWidth=443&originalType=binary%E2%88%B6=1&size=51967&status=done&style=none&taskId=u316592ca-bd6b-4219-adea-510455efcd2&width=443" srcset="/img/loading.gif" lazyload alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625848740771-27f854f4-f5f6-4c7f-966f-5dafad058099.png#clientId=u3d9adbb4-f372-4&from=paste&height=487&id=ue72a1d3b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=487&originWidth=711&originalType=binary%E2%88%B6=1&size=53271&status=done&style=none&taskId=u52875e76-2a8c-49ce-8a35-25b0678eead&width=711" srcset="/img/loading.gif" lazyload alt="image.png">!<a target="_blank" rel="noopener" href="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625848766118-dc3ab2ba-60ce-4276-96e3-24fad8e48117.png#clientId=u3d9adbb4-f372-4&from=paste&height=398&id=u4b1dee89&margin=%5Bobject%20Object%5D&name=image.png&originHeight=398&originWidth=723&originalType=binary%E2%88%B6=1&size=42887&status=done&style=none&taskId=u34b36891-4dbf-4c51-917d-e5925b3aeca&width=723">image.png</a><br>查看当前服务器程序支持的存储引擎</p>
<figure class="highlight abnf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs abnf">show engines<span class="hljs-comment">;</span><br></code></pre></div></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625882550394-4b7287a0-af6f-489e-bd6d-a5d232d406fc.png#clientId=u0148d4bb-e7f9-4&from=paste&height=141&id=u85c441d0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=281&originWidth=1199&originalType=binary%E2%88%B6=1&size=58085&status=done&style=none&taskId=u2d295fdb-3eff-4b94-9573-59a49e3d1ab&width=599.5" srcset="/img/loading.gif" lazyload alt="image.png"><br>设置表的存储引擎</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> 表名(<br>	...<br>)ENGINE <span class="hljs-operator">=</span> 存储引擎名称;<br></code></pre></div></td></tr></table></figure>

<p>修改表存储引擎</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 ENGINE <span class="hljs-operator">=</span> 存储引擎名称;<br></code></pre></div></td></tr></table></figure>

<h1 id="第-2-章-MySQL-的调控按钮-启动选项和系统变量"><a href="#第-2-章-MySQL-的调控按钮-启动选项和系统变量" class="headerlink" title="第 2 章 MySQL 的调控按钮-启动选项和系统变量"></a>第 2 章 MySQL 的调控按钮-启动选项和系统变量</h1><h2 id="缺省值"><a href="#缺省值" class="headerlink" title="缺省值"></a>缺省值</h2><ul>
<li>服务器允许同时连入的客户端的默认数量是 <strong>151</strong></li>
<li>表的默认存储引擎是 <strong>InnoDB</strong></li>
</ul>
<h2 id="命令行使用选项"><a href="#命令行使用选项" class="headerlink" title="命令行使用选项"></a>命令行使用选项</h2><p>1.禁止客户端使用 TCP/IP 网络通信</p>
<figure class="highlight ada"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ada">mysqld <span class="hljs-comment">--skir-networking</span><br></code></pre></div></td></tr></table></figure>

<p>2.修改默认存储引擎</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">#修改默认存储引擎<br>msqld <span class="hljs-comment">--default-storage-engine=MyISAM</span><br>#创建表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> sys_var_demo(i <span class="hljs-type">int</span>);<br>#查看<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> sys_var_demo;<br></code></pre></div></td></tr></table></figure>

<p>选项的长形式和短形式<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625886500037-3ad5c137-a732-41cf-924b-2e58a37bea58.png#clientId=u0148d4bb-e7f9-4&from=paste&height=116&id=u6bfc7d32&margin=%5Bobject%20Object%5D&name=image.png&originHeight=232&originWidth=298&originalType=binary%E2%88%B6=1&size=10545&status=done&style=none&taskId=u3b802720-48c4-498b-ad03-8214cffa811&width=149" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h2 id="配置文件使用选项"><a href="#配置文件使用选项" class="headerlink" title="配置文件使用选项"></a>配置文件使用选项</h2><p>1.配置文件路径<br>Windows 下<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625886647146-570c93b6-f373-451b-842e-0e039a0d9340.png#clientId=u0148d4bb-e7f9-4&from=paste&height=117&id=u1d60e9ec&margin=%5Bobject%20Object%5D&name=image.png&originHeight=233&originWidth=576&originalType=binary%E2%88%B6=1&size=21758&status=done&style=none&taskId=u3a470d6f-8ff9-41e5-b055-9dbbf443106&width=288" srcset="/img/loading.gif" lazyload alt="image.png"><br>Linux 下<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625886743939-9f364a53-4cc2-4646-9b79-b3451b8a49a5.png#clientId=u0148d4bb-e7f9-4&from=paste&height=222&id=u94b43883&margin=%5Bobject%20Object%5D&name=image.png&originHeight=443&originWidth=512&originalType=binary%E2%88%B6=1&size=33546&status=done&style=none&taskId=u9f04bb74-da73-4ff6-896f-f64f00a9bde&width=256" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<blockquote>
<p>在我的计算机中这几个路径中的任意一个都可以当作配置文件来使用,如果它们不存在,你可以手动创建一个,比方说我手动在 ~/.my.cnf 这个路径下创建一个配置文件。</p>
</blockquote>
<h2 id="配置文件的优先级"><a href="#配置文件的优先级" class="headerlink" title="配置文件的优先级"></a>配置文件的优先级</h2><p>不同文件：~/.my.cnf &gt; /etc/my.cnf<br>同个文件内：以最后出现的配置为优先<br>​</p>
<p>如果我们不想让 MySQL 到默认的路径下搜索配置文件(就是上表中列出的那些),可以在命令行指定 defaults-file 选项,比如这样(以 UNIX 系统为例):</p>
<figure class="highlight gradle"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gradle">mysqld --defaults-<span class="hljs-keyword">file</span>=<span class="hljs-regexp">/tmp/my</span>config.txt<br></code></pre></div></td></tr></table></figure>

<p>这样,在程序启动的时候将只在 /tmp/myconfig.txt 路径下搜索配置文件</p>
<h2 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h2><figure class="highlight vala"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vala"><span class="hljs-meta">#查看全部</span><br>show variables<br><span class="hljs-meta">#查看最大链接数</span><br>SHOW VARIABLES like <span class="hljs-string">&#x27;max_connections&#x27;</span>;<br><span class="hljs-meta">#查看默认存储引擎</span><br>SHOW VARIABLES LIKE <span class="hljs-string">&#x27;default_storage_engine&#x27;</span>;<br></code></pre></div></td></tr></table></figure>

<p>设置系统变量</p>
<blockquote>
<p>可通过两种方式进行设置，命令行和配置文件（上述）</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">mysqld <span class="hljs-attribute">--default-storage-engine</span>=MyISAM <span class="hljs-attribute">--max-connections</span>=10<br></code></pre></div></td></tr></table></figure>

<blockquote>
<p>对于启动选项来说,如果启动选项名由多个单词组成,各个单词之间用短划线 - 或者下划线 _ 连接起来都可以,但是对应的系统变量之间必须使用下划线 _ 连接起来</p>
</blockquote>
<p>系统变量 比较牛逼的一点就是,<strong>对于大部分系统变量来说,它们的值可以在服务器程序运行过程中进行动态修改而无需停止并重启服务器</strong>。<br>​</p>
<p>系统变量的作用域</p>
<blockquote>
<p>有一些系统变量并不是针对单个客户端的,比如允许同时连接到服务器的客户端数量 max_connections ,查询缓存的大小 query_cache_size ,这些公有的系统变量让某个客户端私有显然不合适。</p>
</blockquote>
<p>一个新连接到服务器的客户端对应的系统变量的值该怎么设置?<br>为了解决这两个问题,设计 MySQL 的大叔提出了系统变量的 作用范围 的概念,具体来说 <strong>作用范围</strong> 分为这两<br>种:</p>
<ul>
<li><strong>GLOBAL</strong> :全局变量,影响服务器的整体操作。</li>
<li><strong>SESSION</strong> :会话变量,影响某个客户端连接的操作。(注: SESSION 有个别名叫 LOCAL )</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql">在服务器程序运行期间通过客户端程序设置系统变量的语法:<br><span class="hljs-keyword">SET</span> [<span class="hljs-keyword">GLOBAL</span>|<span class="hljs-keyword">SESSION</span>] 系统变量名 = 值;<br>或者写成这样也行:<br><span class="hljs-keyword">SET</span> [@@(<span class="hljs-keyword">GLOBAL</span>|<span class="hljs-keyword">SESSION</span>).]var_name = XXX;<br></code></pre></div></td></tr></table></figure>

<p>比如我们想在服务器运行过程中把作用范围为 GLOBAL 的系统变量 default_storage_engine 的值修改为 MyISAM ,也就是想让之后新连接到服务器的客户端都用 MyISAM 作为默认的存储引擎,那我们可以选择下边两条<br>语句中的任意一条来进行设置:</p>
<figure class="highlight gams"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gams">语句一:<span class="hljs-keyword">SET</span> GLOBAL <span class="hljs-comment">default_storage_engine = MyISAM</span>;<br>语句二:<span class="hljs-keyword">SET</span> @@GLOBAL.default_storage_engine <span class="hljs-comment">= MyISAM</span>;<br></code></pre></div></td></tr></table></figure>

<p>如果只想对本客户端生效,也可以选择下边三条语句中的任意一条来进行设置:</p>
<figure class="highlight gams"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gams">语句一:<span class="hljs-keyword">SET</span> SESSION <span class="hljs-comment">default_storage_engine = MyISAM</span>;<br>语句二:<span class="hljs-keyword">SET</span> @@SESSION.default_storage_engine <span class="hljs-comment">= MyISAM</span>;<br>语句三:<span class="hljs-keyword">SET</span> default_storage_engine <span class="hljs-comment">= MyISAM</span>;<br></code></pre></div></td></tr></table></figure>

<p>从上边的 语句三 也可以看出,如果在设置系统变量的语句中省略了作用范围,默认的作用范围就是 SESSION 。<br>也就是说 <strong>SET 系统变量名 = 值 和 SET SESSION 系统变量名 = 值</strong> 是等价的。<br>​</p>
<p>查看不同作用域的系统变量</p>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">SHOW</span> [<span class="hljs-keyword">GLOBAL</span>|<span class="hljs-keyword">SESSION</span>] VARIABLES [<span class="hljs-keyword">LIKE</span> 匹配的模式];<br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">SESSION</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;default_storage_engine&#x27;</span>;<br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">GLOBAL</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;default_storage_engine&#x27;</span>;<br><span class="hljs-keyword">SET</span> <span class="hljs-keyword">SESSION</span> default_storage_engine = MyISAM;<br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">SESSION</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;default_storage_engine&#x27;</span>;<br></code></pre></div></td></tr></table></figure>

<h2 id="状态变量"><a href="#状态变量" class="headerlink" title="状态变量"></a>状态变量</h2><p>为了让我们更好的了解服务器程序的运行情况, MySQL 服务器程序中维护了好多关于程序运行状态的变量,它们被称为 状态变量 。比方说 Threads_connected 表示当前有多少客户端与服务器建立了连接, Handler_update<br>表示已经更新了多少行记录吧啦吧啦,像这样显示服务器程序状态信息的 状态变量 还有好几百个．<br>​</p>
<p>所以查看 状态变量 的语句可以这么写:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">SHOW</span> [<span class="hljs-keyword">GLOBAL</span>|<span class="hljs-keyword">SESSION</span>] STATUS [<span class="hljs-keyword">LIKE</span> 匹配的模式];<br></code></pre></div></td></tr></table></figure>

<p>类似的,如果我们不写明作用范围,默认的作用范围是 SESSION ,比方说这样:</p>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">SHOW</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;thread%&#x27;</span>;<br></code></pre></div></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625894672351-5304540d-f661-4fa6-ac7d-23e6b778546d.png#clientId=u0148d4bb-e7f9-4&from=paste&height=95&id=ubafe5f09&margin=%5Bobject%20Object%5D&name=image.png&originHeight=189&originWidth=423&originalType=binary%E2%88%B6=1&size=14445&status=done&style=none&taskId=u91065d42-9cb7-4ce7-b8c6-3a96fc5f1d3&width=211.5" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h1 id="第-3-章乱码的前世今生-字符集和比较规则"><a href="#第-3-章乱码的前世今生-字符集和比较规则" class="headerlink" title="第 3 章乱码的前世今生-字符集和比较规则"></a>第 3 章乱码的前世今生-字符集和比较规则</h1><p>将一个字符映射成一个二进制数据的过程也叫做 <strong>编码</strong> ,将一个二进制数据映射到一个字符的过程叫做 <strong>解码</strong></p>
<h2 id="比较规则简介"><a href="#比较规则简介" class="headerlink" title="比较规则简介"></a>比较规则简介</h2><p>在我们确定了 xiaohaizi 字符集表示字符的范围以及编码规则后,怎么比较两个字符的大小呢?最容易想到的就<br>是直接比较这两个字符对应的二进制编码的大小,比方说字符 ‘a’ 的编码为 0x01 ,字符 ‘b’ 的编码为 0x02 ,<br>所以 ‘a’ 小于 ‘b’ ,这种简单的比较规则也可以被称为二进制比较规则,英文名为 binary collation 。<br>二进制比较规则是简单,但有时候并不符合现实需求,比如在很多场合对于英文字符我们都是不区分大小写的,<br>也就是说 ‘a’ 和 ‘A’ 是相等的,在这种场合下就不能简单粗暴的使用二进制比较规则了,这时候我们可以这样指<br>定比较规则:</p>
<ol>
<li>将两个大小写不同的字符全都转为大写或者小写。</li>
<li>再比较这两个字符对应的二进制数据。<br>​</li>
</ol>
<p>这是一种稍微复杂一点点的比较规则,但是实际生活中的字符不止英文字符一种,比如我们的汉字有几万之多,对于某一种字符集来说,比较两个字符大小的规则可以制定出很多种,也就是说同一种字符集可以有多种比较规则,我们稍后就要介绍各种现实生活中用的字符集以及它们的一些比较规则。</p>
<h2 id="MySQL-中支持的字符集和排序规则"><a href="#MySQL-中支持的字符集和排序规则" class="headerlink" title="MySQL 中支持的字符集和排序规则"></a>MySQL 中支持的字符集和排序规则</h2><p>​</p>
<ul>
<li>MySQL 中的 utf8 和 utf8mb4</li>
</ul>
<p>​</p>
<p>我们上边说 utf8 字符集表示一个字符需要使用 1<del>4 个字节,但是我们常用的一些字符使用 1</del>3 个字节就可以表<br>示了。而在 MySQL 中字符集表示一个字符所用最大字节长度在某些方面会影响系统的存储和性能,所以设计<br>MySQL 的大叔偷偷的定义了两个概念:</p>
<ul>
<li>utf8mb3 :阉割过的 utf8 字符集,只使用 1~3 个字节表示字符。</li>
<li>utf8mb4 :正宗的 utf8 字符集,使用 1~4 个字节表示字符。</li>
</ul>
<p>​</p>
<p>有一点需要大家十分的注意,在 MySQL 中 utf8 是 utf8mb3 的别名,所以之后在 MySQL 中提到 utf8 就意味着使<br>用 1~3 个字节来表示一个字符,如果大家有使用 4 字节编码一个字符的情况,比如存储一些 emoji 表情啥的,那请<br>使用 utf8mb4 。<br>​</p>
<p>字符集查看</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> (<span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span><span class="hljs-operator">|</span>CHARSET) [<span class="hljs-keyword">LIKE</span> 匹配的模式];<br></code></pre></div></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625906763082-adf29711-10e3-42fb-a215-f0e9e49ef57a.png#clientId=u0148d4bb-e7f9-4&from=paste&height=436&id=ud51ffd77&margin=%5Bobject%20Object%5D&name=image.png&originHeight=871&originWidth=738&originalType=binary%E2%88%B6=1&size=165696&status=done&style=none&taskId=u952da62b-a3e3-4e28-b409-f9d69346854&width=369" srcset="/img/loading.gif" lazyload alt="image.png"><br>注意返回结果中的最后一列 Maxlen ,它代表该种字符集表示<strong>一个字符最多需要几个字节</strong>。<br>​</p>
<p>比较规则的查看</p>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">COLLATION</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;utf8\_%&#x27;</span>;<br></code></pre></div></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625908369548-071b656f-77ec-4cea-a953-d807cc200e74.png#clientId=u0148d4bb-e7f9-4&from=paste&height=309&id=u30095fe7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=618&originWidth=733&originalType=binary%E2%88%B6=1&size=101024&status=done&style=none&taskId=u6ea0dacc-354e-4f53-aecd-9174733ef5a&width=366.5" srcset="/img/loading.gif" lazyload alt="image.png"><br><strong>比较规则的命名的规律</strong><br>具体规律如下:</p>
<ul>
<li>比较规则名称以与其关联的字符集的名称开头。如上图的查询结果的比较规则名称都是以 utf8 开头的。</li>
<li>后边紧跟着该比较规则主要作用于哪种语言,比如 utf8_polish_ci 表示以波兰语的规则比较,utf8_spanish_ci 是以西班牙语的规则比较, utf8_general_ci 是一种通用的比较规则。</li>
<li>名称后缀意味着该比较规则是否区分语言中的重音、大小写啥的,具体可以用的值如下:</li>
</ul>
<figure class="highlight gherkin"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gherkin">|<span class="hljs-string">后缀</span>|<span class="hljs-string">英文释义</span>|<span class="hljs-string">描述</span>|<span class="hljs-string"> </span>|<span class="hljs-string">:--:</span>|<span class="hljs-string">:--:</span>|<span class="hljs-string">:--:</span>|<span class="hljs-string"> </span>|<span class="hljs-string"> _ai </span>|<span class="hljs-string"> accent insensitive </span>|<span class="hljs-string">不区分重音</span>|<span class="hljs-string"> </span>|<span class="hljs-string"> _as </span>|<span class="hljs-string"> accent sensitive </span>|<span class="hljs-string">区分重</span><br><span class="hljs-string">音</span>|<span class="hljs-string"> </span>|<span class="hljs-string"> _ci </span>|<span class="hljs-string"> case insensitive </span>|<span class="hljs-string">不区分大小写</span>|<span class="hljs-string"> </span>|<span class="hljs-string"> _cs </span>|<span class="hljs-string"> case sensitive </span>|<span class="hljs-string">区分大小写</span>|<span class="hljs-string"> </span>|<span class="hljs-string"> _bin </span>|<span class="hljs-string"> binary </span>|<span class="hljs-string">以二进制</span><br><span class="hljs-string">方式比较</span>|<br><br></code></pre></div></td></tr></table></figure>

<p>比如 utf8_general_ci 这个比较规则是以 ci 结尾的,说明不区分大小写。<br>每种字符集对应若干种比较规则,每种字符集都有一种默认的比较规则, SHOW COLLATION 的返回结果中的<br>Default 列的值为 YES 的就是该字符集的默认比较规则,比方说 utf8 字符集默认的比较规则就是<br>utf8_general_ci 。<br>​</p>
<p>MySQL 有 4 个级别的字符集和比较规则,分别是:</p>
<ul>
<li>服务器级别</li>
<li>数据库级别</li>
<li>表级别</li>
<li>列级别</li>
</ul>
<p>​</p>
<p>查看比较规则系统变量</p>
<figure class="highlight gams"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gams">SHOW <span class="hljs-keyword">VARIABLES</span> LIKE <span class="hljs-comment">&#x27;collation_server&#x27;</span>;<br></code></pre></div></td></tr></table></figure>

<p>指定比较规则和修改比较规则</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">#数据库级别<br><span class="hljs-keyword">CREATE</span> DATABASE 数据库名<br>[[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> 字符集名称]<br>[[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-keyword">COLLATE</span> 比较规则名称];<br><br><span class="hljs-keyword">ALTER</span> DATABASE 数据库名<br>[[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> 字符集名称]<br>[[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-keyword">COLLATE</span> 比较规则名称];<br><br>#表级别<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> 表名 (列的信息)<br>[[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> 字符集名称]<br>[<span class="hljs-keyword">COLLATE</span> 比较规则名称]]<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名<br>[[<span class="hljs-keyword">DEFAULT</span>] <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> 字符集名称]<br>[<span class="hljs-keyword">COLLATE</span> 比较规则名称]<br><br>#列级别<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> 表名(<br>列名 字符串类型 [<span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> 字符集名称] [<span class="hljs-keyword">COLLATE</span> 比较规则名称],<br>其他列...<br>);<br><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 MODIFY 列名 字符串类型 [<span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> 字符集名称] [<span class="hljs-keyword">COLLATE</span> 比较规则名称];<br></code></pre></div></td></tr></table></figure>

<p><strong>character_set_database 和 collation_database 这两个系统变量是只读的,我们不能通过修改这两个变量的值而改变当前数据库的字符集和比较规则</strong><br>​</p>
<ul>
<li>只修改字符集,则比较规则将变为修改后的字符集默认的比较规则。</li>
<li>只修改比较规则,则字符集将变为修改后的比较规则对应的字符集</li>
</ul>
<p>​</p>
<ul>
<li>如果创建或修改列时没有显式的指定字符集和比较规则,则该列默认用表的字符集和比较规则</li>
<li>如果创建或修改表时没有显式的指定字符集和比较规则,则该表默认用数据库的字符集和比较规则</li>
<li>如果创建或修改数据库时没有显式的指定字符集和比较规则,则该数据库默认用服务器的字符集和比较规则</li>
</ul>
<p>​</p>
<p>​</p>
<p>我们知道字符 ‘我’ 在 utf8 字符集编码下的字节串长这样: 0xE68891 ,如果一个程序把这个字节串发送到另一个程序里,另一个程序用不同的字符集去解码这个字节串,假设使用的是 gbk 字符集来解释这串字节,解码过程<br>就是这样的:<br>​</p>
<ol>
<li>首先看第一个字节 0xE6 ,它的值大于 0x7F (十进制:127),说明是两字节编码,继续读一字节后是 0xE688 ,然后从 gbk 编码表中查找字节为 0xE688 对应的字符,发现是字符 ‘鎴’</li>
<li>继续读一个字节 0x91 ,它的值也大于 0x7F ,再往后读一个字节发现木有了,所以这是半个字符。</li>
<li>所以 0xE68891 被 gbk 字符集解释成一个字符 ‘鎴’ 和半个字符。<br>​</li>
</ol>
<p>假设用 iso-8859-1 ,也就是 latin1 字符集去解释这串字节,解码过程如下: 1.先读第一个字节 0xE6 ,它对应的 latin1 字符为 æ 。 2.再读第二个字节 0x88 ,它对应的 latin1 字符为 ˆ 。 3.再读第二个字节 0x91 ,它对应的 latin1 字符为 ‘ 。 4.所以整串字节 0xE68891 被 latin1 字符集解释后的字符串就是 ‘æˆ‘’<br>可见,如果对于同一个字符串编码和解码使用的字符集不一样,会产生意想不到的结果,作为人类的我们看上去就像是产生了乱码一样。<br>​</p>
<p>​</p>
<p><strong>MySQL 中字符集的转换</strong><br>我们知道从客户端发往服务器的请求本质上就是一个字符串,服务器向客户端返回的结果本质上也是一个字符串,而字符串其实是使用某种字符集编码的二进制数据。这个字符串可不是使用一种字符集的编码方式一条道走到黑的,从发送请求到返回结果这个过程中伴随着多次字符集的转换,在这个过程中会用到 3 个系统变量.<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625914411034-130a1ff6-4e94-42e1-86bf-9b3547d2c234.png#clientId=u0148d4bb-e7f9-4&from=paste&height=79&id=uc0e563c3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=158&originWidth=837&originalType=binary%E2%88%B6=1&size=25570&status=done&style=none&taskId=ufdc3e471-5e2b-47e3-887c-9408044760b&width=418.5" srcset="/img/loading.gif" lazyload alt="image.png"><br>处理过程<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625924945322-cbd9fa86-2a4e-46c8-9a81-e0b135478a1d.png#clientId=u0148d4bb-e7f9-4&from=paste&height=216&id=u8adbdd87&margin=%5Bobject%20Object%5D&name=image.png&originHeight=432&originWidth=899&originalType=binary%E2%88%B6=1&size=86425&status=done&style=none&taskId=ub28e123b-d04f-4cb3-8a9a-0f28b4aa031&width=449.5" srcset="/img/loading.gif" lazyload alt="image.png"><br>为了方便我们设置， MySQL 提供了一条非常简便的语句：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">SET NAMES 字符集名;<br></code></pre></div></td></tr></table></figure>

<p>这一条语句产生的效果和我们执行这 3 条的效果是一样的：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">SET character_set_client = 字符集名;<br>SET character_set_connection = 字符集名;<br>SET character_set_results = 字符集名;<br></code></pre></div></td></tr></table></figure>

<p>比方说我的客户端使用的是 utf8 字符集，所以需要把这几个系统变量的值都设置为 utf8 ：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">SET NAMES utf8;<br></code></pre></div></td></tr></table></figure>

<h1 id="第-4-章从一条记录说起-InnoDB-记录结构"><a href="#第-4-章从一条记录说起-InnoDB-记录结构" class="headerlink" title="第 4 章从一条记录说起-InnoDB 记录结构"></a>第 4 章从一条记录说起-InnoDB 记录结构</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>InnoDB 是一个将表中的数据存储到磁盘上的存储引擎，所以即使关机后重启我们的数据还是存在的。而真正处 理数据的过程是发生在内存中的，所以需要把磁盘中的数据加载到内存中，如果是处理写入或修改请求的话，还 需要把内存中的内容刷新到磁盘上。而我们知道读写磁盘的速度非常慢，和内存读写差了几个数量级，所以当我 们想从表中获取某些记录时， InnoDB 存储引擎需要一条一条的把记录从磁盘上读出来么？不，那样会慢死， InnoDB 采取的方式是：将数据划分为若干个页，以页作为磁盘和内存之间交互的基本单位，InnoDB 中页的大小 一般为 16 KB。也就是在一般情况下，一次最少从磁盘中读取 16KB 的内容到内存中，一次最少把内存中的 16KB<br>内容刷新到磁盘中。</p>
<h2 id="InnoDB-行格式"><a href="#InnoDB-行格式" class="headerlink" title="InnoDB 行格式"></a>InnoDB 行格式</h2><p>我们平时是以记录为单位来向表中插入数据的，这些记录在磁盘上的存放方式也被称为 行格式 或者 记录格式 。 设计 InnoDB 存储引擎的大叔们到现在为止设计了 4 种不同类型的 行格式 ，分别是 Compact 、 Redundant 、 Dynamic 和 Compressed 行格式，随着时间的推移，他们可能会设计出更多的行格式，但是不管怎么变，在原理上大体都是相同的。</p>
<ol>
<li>页是 MySQL 中磁盘和内存交互的基本单位，也是 MySQL 是管理存储空间的基本单位。</li>
<li>指定和修改行格式的语法如下：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">CREATE TABLE 表名 (列的信息) ROW_FORMAT=行格式名称<br>ALTER TABLE 表名 ROW_FORMAT=行格式名称<br></code></pre></div></td></tr></table></figure>

<ol start="3">
<li>InnoDB 目前定义了 4 种行格式<br>COMPACT 行格式<br>具体组成如图：<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625935408415-b27599d5-55e1-439b-a4e3-18d0a74b96d7.png#clientId=u131e1089-3e9d-4&from=paste&height=288&id=udc877275&margin=%5Bobject%20Object%5D&name=image.png&originHeight=288&originWidth=896&originalType=binary%E2%88%B6=1&size=59097&status=done&style=none&taskId=uf3509ef5-1446-427e-b041-7bc7b594d5a&width=896" srcset="/img/loading.gif" lazyload alt="image.png"><br>Redundant 行格式<br>具体组成如图：<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625935453817-d30600ac-c4fd-49a7-b538-01aa836a23e6.png#clientId=u131e1089-3e9d-4&from=paste&height=470&id=ubf7179e2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=470&originWidth=867&originalType=binary%E2%88%B6=1&size=103570&status=done&style=none&taskId=u61f272d2-6100-47cb-95b8-2aaecf017e0&width=867" srcset="/img/loading.gif" lazyload alt="image.png"></li>
</ol>
<h2 id="Dynamic-和-Compressed-行格式"><a href="#Dynamic-和-Compressed-行格式" class="headerlink" title="Dynamic 和 Compressed 行格式"></a>Dynamic 和 Compressed 行格式</h2><p>这两种行格式类似于 COMPACT 行格式 ，只不过在处理行溢出数据时有点儿分歧，它们不会在记录的真实<br>数据处存储字符串的前 768 个字节，而是把所有的字节都存储到其他页面中，只在记录的真实数据处存<br>储其他页面的地址。<br>另外， Compressed 行格式会采用压缩算法对页面进行压缩。<br>​</p>
<ol start="4">
<li>一个页一般是 16KB ，当记录中的数据太多，当前页放不下的时候，会把多余的数据存储到其他页中，这种<br>现象称为 行溢出 。</li>
</ol>
<h1 id="第-5-章盛放记录的大盒子-InnoDB-数据页结构"><a href="#第-5-章盛放记录的大盒子-InnoDB-数据页结构" class="headerlink" title="第 5 章盛放记录的大盒子-InnoDB 数据页结构"></a>第 5 章盛放记录的大盒子-InnoDB 数据页结构</h1><h2 id="不同类型的页简介"><a href="#不同类型的页简介" class="headerlink" title="不同类型的页简介"></a>不同类型的页简介</h2><p>前边我们简单提了一下 页 的概念,它是 InnoDB 管理存储空间的基本单位,一个页的大小一般是 16KB 。<br>​</p>
<p>InnoDB 为了不同的目的而设计了许多种不同类型的 页 ,比如存放表空间头部信息的页,存放 Insert Buffer 信息的页,存放 INODE 信息的页,存放 undo 日志信息的页等等等等。当然了,如果我说的这些名词你一个都没有听过,就当我放了个屁吧~ 不过这没有一毛钱关系,我们今儿个也不准备说这些类型的页,我们聚焦的是那些存放我们表中记录的那种类型的页,官方称这种存放记录的页为索引( INDEX )页,鉴于我们还没有了解过索引是个什么东西,而这些表中的记录就是我们日常口中所称的 数据 ,所以目前还是叫这种存放记录的页为 数据页吧。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625966118117-d2d4d9c1-d761-4d6a-b614-290250d600a5.png#clientId=u0148d4bb-e7f9-4&from=paste&height=335&id=u524c67b7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=670&originWidth=712&originalType=binary%E2%88%B6=1&size=111644&status=done&style=none&taskId=ua8789e85-5c1f-4218-a6d7-1641a2463d3&width=356" srcset="/img/loading.gif" lazyload alt="image.png"><br>从图中可以看出,一个 InnoDB 数据页的存储空间大致被划分成了 7 个部分,有的部分占用的字节数是确定的,有的部分占用的字节数是不确定的。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625966151809-bcbcfe33-7208-4b01-8a1f-23aa02495de4.png#clientId=u0148d4bb-e7f9-4&from=paste&height=152&id=ueeb45a45&margin=%5Bobject%20Object%5D&name=image.png&originHeight=304&originWidth=682&originalType=binary%E2%88%B6=1&size=45430&status=done&style=none&taskId=uc8e45a92-03c6-42a7-bd1d-2ad6c2a900b&width=341" srcset="/img/loading.gif" lazyload alt="image.png"><br>在页的 7 个组成部分中,我们自己存储的记录会按照我们指定的 行格式 存储到 User Records 部分。但是在一开始生成页的时候,其实并没有 User Records 这个部分,每当我们插入一条记录,都会从 Free Space 部分,也就<br>是尚未使用的存储空间中申请一个记录大小的空间划分到 User Records 部分,当 Free Space 部分的空间全部<br>被 User Records 部分替代掉之后,也就意味着这个页使用完了,如果还有新的记录插入的话,就需要去申请新<br>的页了,这个过程的图示如下:<br>​</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625967119313-80450118-7a15-423d-a42b-e482a04677ca.png#clientId=u0148d4bb-e7f9-4&from=paste&height=163&id=u0dffbf14&margin=%5Bobject%20Object%5D&name=image.png&originHeight=326&originWidth=910&originalType=binary%E2%88%B6=1&size=67504&status=done&style=none&taskId=uaef0a206-42e5-4f09-b87b-e507cd0c159&width=455" srcset="/img/loading.gif" lazyload alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625968157007-ea43b35f-b7d3-46e9-9aa0-24acc400fe23.png#clientId=u0148d4bb-e7f9-4&from=paste&height=196&id=u3e0b05c2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=391&originWidth=865&originalType=binary%E2%88%B6=1&size=51189&status=done&style=none&taskId=u7b671f73-fadf-4820-ad87-dcd8b80ec4a&width=432.5" srcset="/img/loading.gif" lazyload alt="image.png"><br>从图中可以看到,我们特意把 记录头信息 的 5 个字节的数据给标出来了,说明它很重要,我们再次先把这些 记录头信息 中各个属性的大体意思浏览一下(我们目前使用 Compact 行格式进行演示):<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625968837782-8330b4b1-ecc6-45f2-b04a-ed9d72161585.png#clientId=u0148d4bb-e7f9-4&from=paste&height=179&id=u4e6d8f55&margin=%5Bobject%20Object%5D&name=image.png&originHeight=358&originWidth=874&originalType=binary%E2%88%B6=1&size=48642&status=done&style=none&taskId=u6c0e2ab2-9adc-468e-9799-13e3bd3e115&width=437" srcset="/img/loading.gif" lazyload alt="image.png"><br>行格式简化图<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625968964380-35efab2f-eae3-4c32-868a-a593dafa11c4.png#clientId=u0148d4bb-e7f9-4&from=paste&height=157&id=u70550d21&margin=%5Bobject%20Object%5D&name=image.png&originHeight=314&originWidth=896&originalType=binary%E2%88%B6=1&size=47478&status=done&style=none&taskId=uf826d54c-9fc2-4cf9-81b8-e3a7ff739c7&width=448" srcset="/img/loading.gif" lazyload alt="image.png"><br>向 page_demo 表中插入几条记录:</p>
<figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">INSERT</span> <span class="hljs-selector-tag">INTO</span> <span class="hljs-selector-tag">page_demo</span> <span class="hljs-selector-tag">VALUES</span>(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>, <span class="hljs-string">&#x27;aaaa&#x27;</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">200</span>, <span class="hljs-string">&#x27;bbbb&#x27;</span>), (<span class="hljs-number">3</span>, <span class="hljs-number">300</span>, <span class="hljs-string">&#x27;cccc&#x27;</span>),<br>(<span class="hljs-number">4</span>, <span class="hljs-number">400</span>, <span class="hljs-string">&#x27;dddd&#x27;</span>);<br></code></pre></div></td></tr></table></figure>

<p>Query OK, 4 rows affected (0.00 sec)<br>Records: 4 Duplicates: 0 Warnings: 0<br>为了方便大家分析这些记录在 页 的 User Records 部分中是怎么表示的,我把记录中头信息和实际的列数据都用<br>十进制表示出来了(其实是一堆二进制位),所以这些记录的示意图就是:<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625969285274-90171e44-95c9-4d96-9b73-bba8dd294fc5.png#clientId=u0148d4bb-e7f9-4&from=paste&height=155&id=u3f485aa7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=310&originWidth=875&originalType=binary%E2%88%B6=1&size=65438&status=done&style=none&taskId=ue9822eca-3785-40a6-8973-11a728a2088&width=437.5" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<ul>
<li><strong>delete_mask</strong></li>
</ul>
<p>这个属性标记着当前记录是否被删除,占用 1 个二进制位,值为 0 的时候代表记录并没有被删除,为 1 的时候代表记录被删除掉了。<br>啥?被删除的记录还在 页 中么?是的,摆在台面上的和背地里做的可能大相径庭,你以为它删除了,可它还在真实的磁盘上。这些被删除的记录之所以不立即从磁盘上移除,是因为移除它们之后把其他的记录在磁盘上重新排列需要性能消耗,所以只是打一个删除标记而已,所有被删除掉的记录都会组成一个所谓的 <strong>垃圾链表</strong> ,在这个链表中的记录占用的空间称之为所谓的 可重用空间 ,之后如果有新记录插入到表中的话,可能把这些被删除的记录占用的存储空间覆盖掉。<br>​</p>
<ul>
<li><strong>min_rec_mask</strong></li>
</ul>
<p>B+树的每层非叶子节点中的最小记录都会添加该标记。反正我们自己插入的四条记录的 min_rec_mask 值都是 0 ,意味着它们都不是 B+ 树的非叶<br>子节点中的最小记录。</p>
<ul>
<li><strong>heap_no</strong></li>
</ul>
<p>这个属性表示当前记录在本 页 中的位置,从图中可以看出来,我们插入的 4 条记录在本 页 中的位置分别<br>是: 2 、 3 、 4 、 5 。是不是少了点啥?是的,怎么不见 heap_no 值为 0 和 1 的记录呢?<br>这其实是设计 InnoDB 的大叔们玩的一个小把戏,他们自动给每个页里边儿加了两个记录,由于这两个记录<br>并不是我们自己插入的,所以有时候也称为 伪记录 或者 虚拟记录 。这两个伪记录一个代表 最小记录 ,一<br>个代表 最大记录 ,等一下哈~,记录可以比大小么?<br>是的,记录也可以比大小,对于一条完整的记录来说,比较记录的大小就是比较 主键 的大小。比方说我们<br>插入的 4 行记录的主键值分别是: 1 、 2 、 3 、 4 ,这也就意味着这 4 条记录的大小从小到大依次递增。<br>​</p>
<blockquote>
<p>小贴士:请注意我强调了对于<code>一条完整的记录</code>来说,比较记录的大小就相当于比的是主键的大小。</p>
</blockquote>
<p>​</p>
<p>但是不管我们向 页 中插入了多少自己的记录,设计 InnoDB 的大叔们都规定他们定义的两条伪记录分别为最<br>小记录与最大记录。这两条记录的构造十分简单,都是由 5 字节大小的 记录头信息 和 8 字节大小的一个固定<br>的部分组成的,如图所示<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625972986436-b8fab629-d422-4d91-83f9-35028df7d6c8.png#clientId=u0148d4bb-e7f9-4&from=paste&height=235&id=u07eb3b3c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=470&originWidth=743&originalType=binary%E2%88%B6=1&size=76074&status=done&style=none&taskId=u94e3890a-fb01-4742-8841-7d2f63a34fe&width=371.5" srcset="/img/loading.gif" lazyload alt="image.png"><br>由于这两条记录不是我们自己定义的记录,所以它们并不存放在 页 的 User Records 部分,他们被单独放在一个称为 Infimum + Supremum 的部分,如图所示:<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625975530481-0e6536a3-83db-4667-890b-e09d3fcc84ee.png#clientId=u0148d4bb-e7f9-4&from=paste&height=200&id=u95282242&margin=%5Bobject%20Object%5D&name=image.png&originHeight=399&originWidth=878&originalType=binary%E2%88%B6=1&size=79827&status=done&style=none&taskId=ue92d0bde-8a8d-4294-84fe-c5625f48fd7&width=439" srcset="/img/loading.gif" lazyload alt="image.png"><br>从图中我们可以看出来,最小记录和最大记录的 heap_no 值分别是 0 和 1 ,也就是说它们的位置最靠前。<br>​</p>
<ul>
<li><strong>record_type</strong></li>
</ul>
<p>这个属性表示当前记录的类型,一共有 4 种类型的记录, 0 表示普通记录, 1 表示 B+树非叶节点记录, 2 表<br>示最小记录, 3 表示最大记录。从图中我们也可以看出来,我们自己插入的记录就是普通记录,它们的<br>record_type 值都是 0 ,而最小记录和最大记录的 record_type 值分别为 2 和 3 。<br>至于 record_type 为 1 的情况,我们之后在说索引的时候会重点强调的。<br>​</p>
<ul>
<li><strong>next_record</strong></li>
</ul>
<p>这玩意儿非常重要,它表示从当前记录的真实数据到下一条记录的真实数据的地址偏移量。比方说第一条记<br>录的 next_record 值为 32 ,意味着从第一条记录的真实数据的地址处向后找 32 个字节便是下一条记录的<br>真实数据。如果你熟悉数据结构的话,就立即明白了,这其实是个 链表 ,可以通过一条记录找到它的下一<br>条记录。但是需要注意注意再注意的一点是, 下一条记录 <strong>指得并不是按照我们插入顺序的下一条记录,而</strong><br><strong>是按照主键值由小到大的顺序的下一条记录</strong>。而且规定 Infimum 记录(也就是最小记录) 的下一条记录就是<br>本页中主键值最小的用户记录,而本页中主键值最大的用户记录的下一条记录就是 Supremum 记录(也就<br>是最大记录) ,为了更形象的表示一下这个 next_record 起到的作用,我们用箭头来替代一下<br>next_record 中的地址偏移量:<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625975791753-d82ed46a-ed5f-44b3-ba95-e3329e043d44.png#clientId=u0148d4bb-e7f9-4&from=paste&height=230&id=u45bbfe77&margin=%5Bobject%20Object%5D&name=image.png&originHeight=460&originWidth=885&originalType=binary%E2%88%B6=1&size=80778&status=done&style=none&taskId=ub0b64dbb-aef6-489a-b5f4-0030e24a10b&width=442.5" srcset="/img/loading.gif" lazyload alt="image.png"><br>从图中可以看出来,我们的记录按照主键从小到大的顺序形成了一个单链表。 最大记录 的 next_record 的值为 0 ,这也就是说最大记录是没有 下一条记录 了,它是这个单链表中的最后一个节点。如果从中删除掉<br>一条记录,这个链表也是会跟着变化的,比如我们把第 2 条记录删掉:</p>
<figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; DELETE FROM page_demo WHERE c<span class="hljs-number">1</span> = <span class="hljs-number">2</span>;<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">1</span> row affected (<span class="hljs-number">0</span>.<span class="hljs-number">02</span> sec)<br></code></pre></div></td></tr></table></figure>

<p>删掉第 2 条记录后的示意图就是:<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625975854173-b5da49d0-afbd-4d23-a5cb-be664d29c54b.png#clientId=u0148d4bb-e7f9-4&from=paste&height=209&id=u91b5a971&margin=%5Bobject%20Object%5D&name=image.png&originHeight=417&originWidth=852&originalType=binary%E2%88%B6=1&size=78701&status=done&style=none&taskId=u7ff183bc-6f4d-4765-974c-a8ee95305d5&width=426" srcset="/img/loading.gif" lazyload alt="image.png"><br>从图中可以看出来,删除第 2 条记录前后主要发生了这些变化:</p>
<ul>
<li>第 2 条记录并没有从存储空间中移除,而是把该条记录的 delete_mask 值设置为 1 。</li>
<li>第 2 条记录的 next_record 值变为了 0,意味着该记录没有下一条记录了。</li>
<li>第 1 条记录的 next_record 指向了第 3 条记录。</li>
<li>还有一点你可能忽略了,就是 最大记录 的 n_owned 值从 5 变成了 4 ,关于这一点的变化我们稍后会详细说明的。</li>
</ul>
<p>所以,不论我们怎么对页中的记录做增删改操作,InnoDB 始终会维护一条记录的单链表,链表中的各个节点是按照主键值由小到大的顺序连接起来的。<br>​</p>
<blockquote>
<p>小贴士:你会不会觉得 next_record 这个指针有点儿怪,为啥要指向记录头信息和真实数据之间的位置呢?为啥不干脆指向整条记录的开头位置,也就是记录的额外信息开头的位置呢?因为这个位置刚刚好,向左读取就是记录头信息,向右读取就是真实数据。我们前边还说过变长字段长度列表、NULL 值列表中的信息都是逆序存放,这样可以使记录中位置靠前的字段和它们对应的字段长度信息在内存中的距离更近,可能会提高高速缓存的命中率。当然如果你看不懂这句话的话就不要勉强了,果断跳过~</p>
</blockquote>
<p>再来看一个有意思的事情,因为主键值为 2 的记录被我们删掉了,但是存储空间却没有回收,如果我们再次把这条记录插入到表中,会发生什么事呢?</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> page_demo <span class="hljs-keyword">VALUES</span>(<span class="hljs-number">2</span>, <span class="hljs-number">200</span>, <span class="hljs-string">&#x27;bbbb&#x27;</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br></code></pre></div></td></tr></table></figure>

<p>我们看一下记录的存储情况:<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625976010449-051a5779-24bf-4a3c-b28c-9a293cd657fa.png#clientId=u0148d4bb-e7f9-4&from=paste&height=226&id=ufa26d833&margin=%5Bobject%20Object%5D&name=image.png&originHeight=451&originWidth=871&originalType=binary%E2%88%B6=1&size=87074&status=done&style=none&taskId=u71e4be98-0ab9-4ffb-be8c-6f9d595af29&width=435.5" srcset="/img/loading.gif" lazyload alt="image.png"><br>从图中可以看到, InnoDB 并没有因为新记录的插入而为它申请新的存储空间,而是直接复用了原来被删除记录的存储空间。</p>
<blockquote>
<p>小贴士:当数据页中存在多条被删除掉的记录时,这些记录的 next_record 属性将会把这些被删除掉的记录组成一个垃圾链表,以备之后重用这部分存储空间。</p>
</blockquote>
<h2 id="Page-Directory-页目录"><a href="#Page-Directory-页目录" class="headerlink" title="Page Directory(页目录)"></a>Page Directory(页目录)</h2><ol>
<li>将所有正常的记录(包括最大和最小记录,不包括标记为已删除的记录)划分为几个组。</li>
<li>每个组的最后一条记录(也就是组内最大的那条记录)的头信息中的 n_owned 属性表示该记录拥有多少条记<br>录,也就是该组内共有几条记录。</li>
<li>将每个组的最后一条记录的地址偏移量单独提取出来按顺序存储到靠近 页 的尾部的地方,这个地方就是所谓的 Page Directory ,也就是 页目录 (此时应该返回头看看页面各个部分的图)。页面目录中的这些地址偏移量被称为 槽 (英文名: Slot ),所以这个页面目录就是由 槽 组成的。<br>​</li>
</ol>
<p>比方说现在的 page_demo 表中正常的记录共有 6 条, InnoDB 会把它们分成两组,第一组中只有一个最小记录,<br>第二组中是剩余的 5 条记录,看下边的示意图:<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625976170372-6a8b77de-214f-43b4-b682-baea37e424b7.png#clientId=u0148d4bb-e7f9-4&from=paste&height=245&id=u05056b46&margin=%5Bobject%20Object%5D&name=image.png&originHeight=490&originWidth=895&originalType=binary%E2%88%B6=1&size=92560&status=done&style=none&taskId=u66f653b6-493c-4fd5-bb1b-18acbed7a72&width=447.5" srcset="/img/loading.gif" lazyload alt="image.png"><br>现在 页目录 部分中有两个槽,也就意味着我们的记录被分成了两个组, 槽 1 中的值是 112 ,代表最大记录的地址偏移量(就是从页面的 0 字节开始数,数 112 个字节); 槽 0 中的值是 99 ,代表最小记录的地址偏移量。<br>注意最小和最大记录的头信息中的 n_owned 属性<br>​</p>
<ul>
<li>最小记录的 n_owned 值为 1 ,这就代表着以最小记录结尾的这个分组中只有 1 条记录,也就是最小记录本身。</li>
<li>最大记录的 n_owned 值为 5 ,这就代表着以最大记录结尾的这个分组中只有 5 条记录,包括最大记录本身还有我们自己插入的 4 条记录。</li>
</ul>
<p>99 和 112 这样的地址偏移量很不直观,我们用箭头指向的方式替代数字,这样更易于我们理解,所以修改后的<br>示意图就是这样:<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625985204507-46a7217c-cfa0-484d-8063-e150f0d3b7b1.png#clientId=u0148d4bb-e7f9-4&from=paste&height=231&id=ua4d67934&margin=%5Bobject%20Object%5D&name=image.png&originHeight=462&originWidth=860&originalType=binary%E2%88%B6=1&size=73050&status=done&style=none&taskId=u793b9e63-e9f9-490d-8fab-bd1737cc1ae&width=430" srcset="/img/loading.gif" lazyload alt="image.png"><br>单纯从逻辑上看一下这些记录和页目录的关系<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625985254598-4122b57b-144b-468f-9064-14c8dbeb9b3e.png#clientId=u0148d4bb-e7f9-4&from=paste&height=234&id=u96385d1d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=467&originWidth=863&originalType=binary%E2%88%B6=1&size=77604&status=done&style=none&taskId=ua032223d-9a00-48b7-91d1-6bd0cc39b22&width=431.5" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<blockquote>
<p>对于最小记录所在的分组只能有 1 条记录,最大记录所在的分组拥有的记录条数只能在 1<del>8 条之间,剩下的分组中记录的条数范围只能在是 4</del>8 条之间。</p>
</blockquote>
<p>步骤:</p>
<ul>
<li>初始情况下一个数据页里只有最小记录和最大记录两条记录,它们分属于两个分组。</li>
<li>之后每插入一条记录,都会从 页目录 中找到主键值比本记录的主键值大并且差值最小的槽,然后把该槽对应的记录的 n_owned 值加 1,表示本组内又添加了一条记录,直到该组中的记录数等于 8 个。</li>
<li>在一个组中的记录数等于 8 个后再插入一条记录时,会将组中的记录拆分成两个组,一个组中 4 条记录,另一个 5 条记录。这个过程会在 页目录 中新增一个 槽 来记录这个新增分组中最大的那条记录的偏移量。</li>
</ul>
<p>由于现在 page_demo 表中的记录太少,无法演示添加了 页目录 之后加快查找速度的过程,所以再往 page_demo 表中添加一些记录:</p>
<figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"><span class="hljs-selector-tag">mysql</span>&gt; <span class="hljs-selector-tag">INSERT</span> <span class="hljs-selector-tag">INTO</span> <span class="hljs-selector-tag">page_demo</span> <span class="hljs-selector-tag">VALUES</span>(<span class="hljs-number">5</span>, <span class="hljs-number">500</span>, <span class="hljs-string">&#x27;eeee&#x27;</span>), (<span class="hljs-number">6</span>, <span class="hljs-number">600</span>, <span class="hljs-string">&#x27;ffff&#x27;</span>), (<span class="hljs-number">7</span>, <span class="hljs-number">700</span>, <span class="hljs-string">&#x27;gggg&#x27;</span>),<br>(<span class="hljs-number">8</span>, <span class="hljs-number">800</span>, <span class="hljs-string">&#x27;hhhh&#x27;</span>), (<span class="hljs-number">9</span>, <span class="hljs-number">900</span>, <span class="hljs-string">&#x27;iiii&#x27;</span>), (<span class="hljs-number">10</span>, <span class="hljs-number">1000</span>, <span class="hljs-string">&#x27;jjjj&#x27;</span>), (<span class="hljs-number">11</span>, <span class="hljs-number">1100</span>, <span class="hljs-string">&#x27;kkkk&#x27;</span>), (<span class="hljs-number">12</span>, <span class="hljs-number">1200</span>, &#x27;l<br>lll<span class="hljs-string">&#x27;), (13, 1300, &#x27;</span>mmmm<span class="hljs-string">&#x27;), (14, 1400, &#x27;</span>nnnn<span class="hljs-string">&#x27;), (15, 1500, &#x27;</span>oooo<span class="hljs-string">&#x27;), (16, 1600, &#x27;</span>pppp&#x27;);<br><span class="hljs-selector-tag">Query</span> <span class="hljs-selector-tag">OK</span>, <span class="hljs-selector-tag">12</span> <span class="hljs-selector-tag">rows</span> <span class="hljs-selector-tag">affected</span> (<span class="hljs-number">0.00</span> sec)<br><span class="hljs-selector-tag">Records</span>: <span class="hljs-selector-tag">12</span> <span class="hljs-selector-tag">Duplicates</span>: <span class="hljs-selector-tag">0</span> <span class="hljs-selector-tag">Warnings</span>: <span class="hljs-selector-tag">0</span><br></code></pre></div></td></tr></table></figure>

<p>哈,我们一口气又往表中添加了 12 条记录,现在页里边就一共有 18 条记录了(包括最小和最大记录),这些记录<br>被分成了 5 个组,如图所示:<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625985774761-249c901d-d32f-4c36-bd90-912ccfff9002.png#clientId=u0148d4bb-e7f9-4&from=paste&height=276&id=u7dd645b1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=552&originWidth=874&originalType=binary%E2%88%B6=1&size=134405&status=done&style=none&taskId=u652ec42e-373b-418b-87ba-7b600f52b00&width=437" srcset="/img/loading.gif" lazyload alt="image.png"><br>比方说我们想找主键值为 6 的记录,过程是这样的:</p>
<ol>
<li>计算中间槽的位置: (0+4)/2=2 ,所以查看 槽 2 对应记录的主键值为 8 ,又因为 8 &gt; 6 ,所以设置 high=2 , low 保持不变。</li>
<li>重新计算中间槽的位置: (0+2)/2=1 ,所以查看 槽 1 对应的主键值为 4 ,又因为 4 &lt; 6 ,所以设置 low=1 , high 保持不变。</li>
<li>因为 high - low 的值为 1,所以确定主键值为 5 的记录在 槽 2 对应的组中。此刻我们需要找到 槽 2 中主键值最小的那条记录,然后沿着单向链表遍历 槽 2 中的记录。但是我们前边又说过,每个槽对应的记录都是该组中主键值最大的记录,这里 槽 2 对应的记录是主键值为 8 的记录,怎么定位一个组中最小的记录呢?别忘了各个槽都是挨着的,我们可以很轻易的拿到 槽 1 对应的记录(主键值为 4 ),该条记录的下一条记录就是 槽 2 中主键值最小的记录,该记录的主键值为 5 。所以我们可以从这条主键值为 5 的记录出发,遍历 槽 2 中的各条记录,直到找到主键值为 6 的那条记录即可。由于一个组中包含的记录条数只能是 1~8 条,所以遍历一个组中的记录的代价是很小的。<br>​</li>
</ol>
<p>所以在一个数据页中查找指定主键值的记录的过程分为两步:<br><strong>1. 通过二分法确定该记录所在的槽,并找到该槽中主键值最小的那条记录。</strong><br><strong>2. 通过记录的 next_record 属性遍历该槽所在的组中的各个记录。</strong><br><strong>​</strong></p>
<h2 id="Page-Header-页面头部"><a href="#Page-Header-页面头部" class="headerlink" title="Page Header(页面头部)"></a>Page Header(页面头部)</h2><p>设计 InnoDB 的大叔们为了能得到一个数据页中存储的记录的状态信息,比如本页中已经存储了多少条记录,第一条记录的地址是什么,页目录中存储了多少个槽等等,特意在页中定义了一个叫 Page Header 的部分,它是<br>页 结构的第二部分,这个部分占用固定的 56 个字节,专门存储各种状态信息,具体各个字节都是干嘛的看下<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625986589078-03756c27-c290-44df-9659-ce6eea73f270.png#clientId=u0148d4bb-e7f9-4&from=paste&height=279&id=uadeff1bf&margin=%5Bobject%20Object%5D&name=image.png&originHeight=558&originWidth=890&originalType=binary%E2%88%B6=1&size=109685&status=done&style=none&taskId=u1d33db30-28fb-4412-a0f1-477a4d36715&width=445" srcset="/img/loading.gif" lazyload alt="image.png"><br><strong>PAGE_DIRECTION</strong><br>假如新插入的一条记录的主键值比上一条记录的主键值大,我们说这条记录的插入方向是右边,反之则是左边。用来表示最后一条记录插入方向的状态就是 PAGE_DIRECTION 。<br>​</p>
<p><strong>PAGE_N_DIRECTION</strong><br>假设连续几次插入新记录的方向都是一致的, InnoDB 会把沿着同一个方向插入记录的条数记下来,这个条数就用 PAGE_N_DIRECTION 这个状态表示。当然,如果最后一条记录的插入方向改变了的话,这个状态的值会被清零重新统计。</p>
<h2 id="File-Header-文件头部"><a href="#File-Header-文件头部" class="headerlink" title="File Header(文件头部)"></a>File Header(文件头部)</h2><p>我们现在描述的 File Header 针对各种类型的页都通用,也就是说不同类型的页都会以 File Header 作为第一个组成部分,它描述了一些针对各种页都通用的一些信息,比方说这个页的编号是多少,它的上一个页、下一个页是谁啦吧啦吧啦~ 这个部分占用固定的 38 个字节,是由下边这些内容组成的:<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625990905436-5946edc5-9908-40c8-8f76-4ab45587dc34.png#clientId=u0148d4bb-e7f9-4&from=paste&height=187&id=u91cb86e6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=373&originWidth=899&originalType=binary%E2%88%B6=1&size=53165&status=done&style=none&taskId=ua9de8aed-ae42-40ed-bbe9-8b3ce3b96ce&width=449.5" srcset="/img/loading.gif" lazyload alt="image.png"><br>对照着这个表格,我们看几个目前比较重要的部分:</p>
<ul>
<li>FIL_PAGE_SPACE_OR_CHKSUM</li>
</ul>
<p>这个代表当前页面的校验和(checksum)。啥是个校验和?就是对于一个很长很长的字节串来说,我们会通过某种算法来计算一个比较短的值来代表这个很长的字节串,这个比较短的值就称为 校验和 。这样在比较两个很长的字节串之前先比较这两个长字节串的校验和,如果校验和都不一样两个长字节串肯定是不同的,所以省去了直接比较两个比较长的字节串的时间损耗。<br>​</p>
<ul>
<li>FIL_PAGE_OFFSET</li>
</ul>
<p>每一个 页 都有一个单独的页号,就跟你的身份证号码一样, InnoDB 通过页号来可以唯一定位一个页 。</p>
<ul>
<li>FIL_PAGE_TYPE</li>
</ul>
<p>这个代表当前 页 的类型,我们前边说过, InnoDB 为了不同的目的而把页分为不同的类型,我们上边介绍的其实都是存储记录的 数据页 ,其实还有很多别的类型的页,具体如下表:</p>
<table>
<thead>
<tr>
<th>类型名称</th>
<th>十六进制</th>
<th>描述</th>
<th>:–:</th>
<th>:–:</th>
<th>:–:</th>
<th>:–:</th>
</tr>
</thead>
<tbody><tr>
<td>FIL_PAGE_TYPE_ALLOCATED</td>
<td>0x0000</td>
<td>最新分配,还没使用</td>
<td></td>
<td>FIL_PAGE_UNDO_LOG</td>
<td>0x0002</td>
<td>Undo 日志页</td>
</tr>
<tr>
<td>FIL_PAGE_INODE</td>
<td>0x0003</td>
<td>段信息节点</td>
<td></td>
<td>FIL_PAGE_IBUF_FREE_LIST</td>
<td>0x0004</td>
<td>Insert Buffer 空闲列表</td>
</tr>
<tr>
<td>FIL_PAGE_IBUF_BITMAP</td>
<td>0x0005</td>
<td>Insert Buffer 位图</td>
<td></td>
<td>FIL_PAGE_TYPE_SYS</td>
<td>0x0006</td>
<td>系统页</td>
</tr>
<tr>
<td>FIL_PAGE_TYPE_TRX_SYS</td>
<td>0x0007</td>
<td>事务系统数据</td>
<td></td>
<td>FIL_PAGE_TYPE_FSP_HDR</td>
<td>0x0008</td>
<td>表空间头部信息</td>
</tr>
<tr>
<td>FIL_PAGE_TYPE_XDES</td>
<td>0x0009</td>
<td>扩展描述页</td>
<td></td>
<td>FIL_PAGE_TYPE_BLOB</td>
<td>0x000A</td>
<td>BLOB 页</td>
</tr>
<tr>
<td>FIL_PAGE_INDEX</td>
<td>0x45BF</td>
<td>索引页,也就是我们所说的 数据页</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>我们存放记录的数据页的类型其实是 FIL_PAGE_INDEX ,也就是所谓的 索引页 。<br>​</p>
<ul>
<li>FIL_PAGE_PREV 和 FIL_PAGE_NEXT</li>
</ul>
<p>我们前边强调过, InnoDB 都是以页为单位存放数据的,有时候我们存放某种类型的数据占用的空间非常大(比方说一张表中可以有成千上万条记录), InnoDB 可能不可以一次性为这么多数据分配一个非常大的存储空间,如果分散到多个不连续的页中存储的话需要把这些页关联起来, FIL_PAGE_PREV 和 FIL_PAGE_NEXT 就分别代表本页的上一个和下一个页的页号。这样通过建立一个双向链表把许许多多的页就都串联起来了,而无需这些页在物理上真正连着。需要注意的是,并不是所有类型的页都有上一个和下一个页的属性,不过我们本集中唠叨的 数据页 (也就是类型为 FIL_PAGE_INDEX 的页)是有这两个属性的,所以所有的数据页其<br>实是一个双链表,就像这样:<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1625996086775-cd65a484-ea84-416d-9435-5df231b242ca.png#clientId=u0148d4bb-e7f9-4&from=paste&height=173&id=u0a44df46&margin=%5Bobject%20Object%5D&name=image.png&originHeight=346&originWidth=890&originalType=binary%E2%88%B6=1&size=76075&status=done&style=none&taskId=u9ee35f6e-80ae-4cfc-ae04-1e9b302785c&width=445" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h2 id="File-Trailer"><a href="#File-Trailer" class="headerlink" title="File Trailer"></a>File Trailer</h2><p>我们知道 InnoDB 存储引擎会把数据存储到磁盘上,但是磁盘速度太慢,需要以 页 为单位把数据加载到内存中处理,如果该页中的数据在内存中被修改了,那么在修改后的某个时间需要把数据同步到磁盘中。但是在同步了一半的时候中断电了咋办,这不是莫名尴尬么?为了检测一个页是否完整(也就是在同步的时候有没有发生只同步一半的尴尬情况),设计 InnoDB 的大叔们在每个页的尾部都加了一个 File Trailer 部分,这个部分由 8 个字节组成,可以分成 2 个小部分:</p>
<ul>
<li>前 4 个字节代表页的校验和这个部分是和 File Header 中的校验和相对应的。每当一个页面在内存中修改了,在同步之前就要把它的校验和算出来,因为 File Header 在页面的前边,所以校验和会被首先同步到磁盘,当完全写完时,校验和也会被写到页的尾部,如果完全同步成功,则页的首部和尾部的校验和应该是一致的。如果写了一半儿断电了,那么在 File Header 中的校验和就代表着已经修改过的页,而在 File Trialer 中的校验和代表着原先的页,二者不同则意味着同步中间出了错。</li>
</ul>
<p>​</p>
<ul>
<li>后 4 个字节代表页面被最后修改时对应的日志序列位置(LSN)这个部分也是为了校验页的完整性的,只不过我们目前还没说 LSN 是个什么意思,所以大家可以先不用管这个属性。</li>
</ul>
<p>这个 File Trailer 与 File Header 类似,都是所有类型的页通用的。</p>
<h1 id="第-6-章快速查询的秘籍-B-树索引"><a href="#第-6-章快速查询的秘籍-B-树索引" class="headerlink" title="第 6 章快速查询的秘籍-B+树索引"></a>第 6 章快速查询的秘籍-B+树索引</h1><p>各个数据页可以组成一个 双向链表 ,而每个数据页中的记录会按照主键值从小到大的顺序组成一个 单向链表 ,每个数据页都会为存储在它里边儿的记录生成一个页目录 ,在通过主键查找某条记录的时候可以在 页目录 中使用二分法快速定位到对应的槽,然后再遍历该槽对应分组中的记录即可快速找到指定的记录<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2630542/1626008666713-d4097e67-5360-4d04-a606-129bbd42eeff.png#clientId=u0148d4bb-e7f9-4&from=paste&height=136&id=u0d18b711&margin=%5Bobject%20Object%5D&name=image.png&originHeight=272&originWidth=885&originalType=binary%E2%88%B6=1&size=57435&status=done&style=none&taskId=uc5d29e22-d665-4303-9bd2-f030086fe81&width=442.5" srcset="/img/loading.gif" lazyload alt="image.png"><br>其中页 a、页 b、页 c … 页 n 这些页可以不在物理结构上相连,只要通过双向链表相关联即可。</p>
<h1 id="第-7-章好东西也得先学会怎么用-B-树索引的使用"><a href="#第-7-章好东西也得先学会怎么用-B-树索引的使用" class="headerlink" title="第 7 章好东西也得先学会怎么用-B+树索引的使用"></a>第 7 章好东西也得先学会怎么用-B+树索引的使用</h1><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="第-8-章数据的家-MySQL-的数据目录"><a href="#第-8-章数据的家-MySQL-的数据目录" class="headerlink" title="第 8 章数据的家-MySQL 的数据目录"></a>第 8 章数据的家-MySQL 的数据目录</h1><h1 id="-1"><a href="#-1" class="headerlink" title=""></a></h1><h1 id="第-9-章存放页面的大池子-InnoDB-的表空间"><a href="#第-9-章存放页面的大池子-InnoDB-的表空间" class="headerlink" title="第 9 章存放页面的大池子-InnoDB 的表空间"></a>第 9 章存放页面的大池子-InnoDB 的表空间</h1><h1 id="-2"><a href="#-2" class="headerlink" title=""></a></h1><h1 id="第-10-章条条大路通罗马-单表访问方法"><a href="#第-10-章条条大路通罗马-单表访问方法" class="headerlink" title="第 10 章条条大路通罗马-单表访问方法"></a>第 10 章条条大路通罗马-单表访问方法</h1><h1 id="-3"><a href="#-3" class="headerlink" title=""></a></h1><h1 id="第-11-章两个表的亲密接触-连接的原理"><a href="#第-11-章两个表的亲密接触-连接的原理" class="headerlink" title="第 11 章两个表的亲密接触- 连接的原理"></a>第 11 章两个表的亲密接触- 连接的原理</h1><h1 id="-4"><a href="#-4" class="headerlink" title=""></a></h1><h1 id="第-12-章谁最便宜就选谁-MySQL-基于成本的优化"><a href="#第-12-章谁最便宜就选谁-MySQL-基于成本的优化" class="headerlink" title="第 12 章谁最便宜就选谁-MySQL 基于成本的优化"></a>第 12 章谁最便宜就选谁-MySQL 基于成本的优化</h1><h1 id="-5"><a href="#-5" class="headerlink" title=""></a></h1><h1 id="第-13-章兵马未动，粮草先行-InnoDB-统计数据是如何收集的"><a href="#第-13-章兵马未动，粮草先行-InnoDB-统计数据是如何收集的" class="headerlink" title="第 13 章兵马未动，粮草先行-InnoDB 统计数据是如何收集的"></a>第 13 章兵马未动，粮草先行-InnoDB 统计数据是如何收集的</h1><h1 id="-6"><a href="#-6" class="headerlink" title=""></a></h1><h1 id="第-14-章不好看就要多整容-MySQL-基于规则的优化-内含关于"><a href="#第-14-章不好看就要多整容-MySQL-基于规则的优化-内含关于" class="headerlink" title="第 14 章不好看就要多整容-MySQL 基于规则的优化(内含关于"></a>第 14 章不好看就要多整容-MySQL 基于规则的优化(内含关于</h1><h1 id="-7"><a href="#-7" class="headerlink" title=""></a></h1><h1 id="第-15-章查询优化的百科全书-Explain-详解-上"><a href="#第-15-章查询优化的百科全书-Explain-详解-上" class="headerlink" title="第 15 章查询优化的百科全书-Explain 详解 (上)"></a>第 15 章查询优化的百科全书-Explain 详解 (上)</h1><h1 id="-8"><a href="#-8" class="headerlink" title=""></a></h1><h1 id="第-16-章查询优化的百科全书-Explain-详解-下"><a href="#第-16-章查询优化的百科全书-Explain-详解-下" class="headerlink" title="第 16 章查询优化的百科全书-Explain 详解 (下)"></a>第 16 章查询优化的百科全书-Explain 详解 (下)</h1><h1 id="-9"><a href="#-9" class="headerlink" title=""></a></h1><h1 id="第-17-章神兵利器-optimizer-trace-表的神器功效"><a href="#第-17-章神兵利器-optimizer-trace-表的神器功效" class="headerlink" title="第 17 章神兵利器- optimizer trace 表的神器功效"></a>第 17 章神兵利器- optimizer trace 表的神器功效</h1><h1 id="-10"><a href="#-10" class="headerlink" title=""></a></h1><h1 id="第-18-章调节磁盘和-CPU-的矛盾-InnoDB-的-Buffer-Pool"><a href="#第-18-章调节磁盘和-CPU-的矛盾-InnoDB-的-Buffer-Pool" class="headerlink" title="第 18 章调节磁盘和 CPU 的矛盾-InnoDB 的 Buffer Pool"></a>第 18 章调节磁盘和 CPU 的矛盾-InnoDB 的 Buffer Pool</h1><h1 id="第-19-章从猫爷被杀说起-事务简介第-20-章说过的话就一定要办到-redo-日志-上"><a href="#第-19-章从猫爷被杀说起-事务简介第-20-章说过的话就一定要办到-redo-日志-上" class="headerlink" title="第 19 章从猫爷被杀说起-事务简介第 20 章说过的话就一定要办到-redo 日志 (上)"></a>第 19 章从猫爷被杀说起-事务简介第 20 章说过的话就一定要办到-redo 日志 (上)</h1><h1 id="-11"><a href="#-11" class="headerlink" title=""></a></h1><h1 id="第-21-章说过的话就一定要办到-redo-日志-下"><a href="#第-21-章说过的话就一定要办到-redo-日志-下" class="headerlink" title="第 21 章说过的话就一定要办到-redo 日志 (下)"></a>第 21 章说过的话就一定要办到-redo 日志 (下)</h1><h1 id="-12"><a href="#-12" class="headerlink" title=""></a></h1><h1 id="第-22-章后悔了怎么办-undo-日志-上"><a href="#第-22-章后悔了怎么办-undo-日志-上" class="headerlink" title="第 22 章后悔了怎么办-undo 日志(上)"></a>第 22 章后悔了怎么办-undo 日志(上)</h1><h1 id="-13"><a href="#-13" class="headerlink" title=""></a></h1><h1 id="第-23-章后悔了怎么办-undo-日志-下"><a href="#第-23-章后悔了怎么办-undo-日志-下" class="headerlink" title="第 23 章后悔了怎么办-undo 日志(下)"></a>第 23 章后悔了怎么办-undo 日志(下)</h1><h1 id="-14"><a href="#-14" class="headerlink" title=""></a></h1><h1 id="第-24-章-条记录的多幅面孔-事务的隔离级别与-MVCC"><a href="#第-24-章-条记录的多幅面孔-事务的隔离级别与-MVCC" class="headerlink" title="第 24 章-条记录的多幅面孔-事务的隔离级别与 MVCC"></a>第 24 章-条记录的多幅面孔-事务的隔离级别与 MVCC</h1><p>​</p>
<h1 id="第-25-章工作面试老大难-锁"><a href="#第-25-章工作面试老大难-锁" class="headerlink" title="第 25 章工作面试老大难-锁"></a>第 25 章工作面试老大难-锁</h1><h1 id="第-26-章写作本书时用到的一些重-要的参考资料"><a href="#第-26-章写作本书时用到的一些重-要的参考资料" class="headerlink" title="第 26 章写作本书时用到的一些重 要的参考资料"></a>第 26 章写作本书时用到的一些重 要的参考资料</h1><p>​</p>
<p><a target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2021/pdf/2630542/1625328000528-45f0b3b0-acaa-4265-bb22-c800837047d0.pdf?_lake_card=%7B%22src%22:%22https://www.yuque.com/attachments/yuque/0/2021/pdf/2630542/1625328000528-45f0b3b0-acaa-4265-bb22-c800837047d0.pdf%22,%22name%22:%22MySQL%E6%98%AF%E6%80%8E%E6%A0%B7%E8%BF%90%E8%A1%8C%E7%9A%84%EF%BC%9A%E4%BB%8E%E6%A0%B9%E5%84%BF%E4%B8%8A%E7%90%86%E8%A7%A3MySQL.pdf%22,%22size%22:18938682,%22type%22:%22application/pdf%22,%22ext%22:%22pdf%22,%22status%22:%22done%22,%22taskId%22:%22ub2d23c91-a589-43f9-a1c0-024046df429%22,%22taskType%22:%22upload%22,%22id%22:%22u60710a1c%22,%22card%22:%22file%22%7D">MySQL 是怎样运行的：从根儿上理解 MySQL.pdf</a></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AF%87/">数据库篇</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/MySQL/">MySQL</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/07/06/yuque/lsztt4/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">中间件篇-Nginx高性能HTTP服务器</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/07/03/yuque/mzmauh/">
                        <span class="hidden-mobile">中间件篇-Kafka分布式发布订阅消息系统</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'mikeygithub/commit-utterance');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->

  <div class="col-lg-7 mx-auto nopadding-x-md">
    <div class="container custom post-custom mx-auto">
      <img src="https://octodex.github.com/images/jetpacktocat.png" srcset="/img/loading.gif" lazyload class="rounded mx-auto d-block mt-5" style="width:150px; height:150px;">
    </div>
  </div>


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     Copyright © 2017-2021 麦奇 Powered by <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> And <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> Core on Github Page 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        桂ICP备2020009931号-1
      </a>
    </span>
    
      
        <span>
          <a
            href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=2020009931"
            rel="nofollow noopener"
            class="beian-police"
            target="_blank"
          >
            
              <span style="visibility: hidden; width: 0">|</span>
              <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"/>
            
            <span>桂公网安备2020009931号</span>
          </a>
        </span>
      
    
  </div>


  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":200})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-svg.js" ></script>

  





  <script  src="https://cdn.jsdelivr.net/npm/mermaid@8.8.3/dist/mermaid.min.js" ></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({"theme":"default"});
    }
  </script>




  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?74301a15e5497361e93588eeee69f4b2";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
